<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, user-scalable=no">
    <link href="/m-css-st.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.3.js"></script>
</head>

<body>
<div>
    <div class="r-card tac">
        <div class="r-nevi-icon">
            <div><a href="javascript:void(0);" class="fs32 grey55" onclick="navigateRecipe(-1);"><</a></div>
            <div id="currentItemNumber" class="fs36 lsm25 fw1 mt2 grey55" th:text="${base.항목일련번호}"></div>
            <div><a href="javascript:void(0);" class="fs32 grey55" onclick="navigateRecipe(1);">></a></div>
        </div>
        <div class="ulm"></div>
        <div>
            <div id="category" class="fs24 lsm10 mt1 grey77" th:text="${base.카테고리}"></div> <!-- 카테고리명 -->
            <div id="recipeName" class="fs48 lsm25 mtm05 mb1" th:text="${base.이름}"></div> <!-- 레시피명 -->
        </div>
        <div id="effects" class="r-effect">
            <div th:each="effect : ${effect}" class="r-effect-round r-c-bg1">
                <a href="#;" onclick="openPopup('#pop_txt1')" style="color:white;" th:text="${effect.효과}"></a>
            </div>
        </div>
        <div class="containerb">
            <div class="layer_pop_txt" id="pop_txt1">
                <div class="pop_content">
                    <div class="title"></div>
                    <ul id="effectsList" class="popup-list grey55">
                        <li th:each="effect : ${effect}" th:text="${effect.효과}">항목</li>
                    </ul>
                    <div><a class="close_btn" href="#;" onclick="closePopup('#pop_txt1')">닫기</a></div>
                </div>
            </div>
        </div>
        <div class="fw5 fs24 grey77 mt2"> 재료</div>
        <div class="ulm"></div>
        <div id="ingredients" th:each="ingredient: ${ingredient}" class="r-icon lsm10 mt05">
            <div class="r-icond">
                <img th:src="@{'/imgs/' + ${ingredient.목록아이콘}}">
            </div>
            <div class="tal grey55" th:text="${ingredient.재료목록}"></div>
        </div>

        <div id="mainImage" class="r-image">
            <img th:src="@{'/imgs/' + ${base.메인이미지}}">
        </div>
        <div class="fw5 fs24 grey77">만드는 순서</div>
        <div class="ulm"></div>
        <div id="recipeSteps" th:each="recipe : ${recipe}" class="tal grey55 pl2 pr2">
            <span th:text="${recipe.조리순서}"></span> <span th:text="${recipe.조리법}"></span>
        </div>
        <div class="ulm"></div>
        <a href="/" class="grey55">
            <div class="r-main-btn mt2 mb2">
                처음으로
            </div>
        </a>

    </div>
</div>
</body>
<script>
    // 현재 항목 일련번호를 설정
    var currentItemNumber = parseInt(document.getElementById('currentItemNumber').textContent);

    // 이전 및 다음 항목으로 탐색하는 함수
    function navigateRecipe(direction) {
        const newItemNumber = currentItemNumber + direction;
        console.log("Navigating to item number: ", newItemNumber);  // 디버깅을 위한 로그 추가

        $.ajax({
            url: "/api/recipe/" + newItemNumber,
            type: "GET",
            success: function(data) {
                // 데이터를 받아와서 페이지를 업데이트 합니다.
                updateRecipeData(data);
                currentItemNumber = newItemNumber;
                document.getElementById('currentItemNumber').textContent = newItemNumber;
            },
            error: function() {
                alert("레시피를 불러오는 중 오류가 발생했습니다.");
            }
        });
    }

    // 페이지를 업데이트하는 함수
    function updateRecipeData(data) {
        // 레시피명 업데이트
        const recipeNameElement = document.getElementById('recipeName');
        if (recipeNameElement) {
            recipeNameElement.textContent = data.base.이름;
        }

        // 카테고리 업데이트
        const categoryElement = document.getElementById('category');
        if (categoryElement) {
            categoryElement.textContent = data.base.카테고리;
        }

        // 효과 업데이트
        const effectsContainer = document.getElementById('effects');
        if (effectsContainer) {
            effectsContainer.innerHTML = '';
            data.effects.forEach(effect => {
                const effectDiv = document.createElement('div');
                effectDiv.classList.add('r-effect-round', 'r-c-bg1');
                const effectLink = document.createElement('a');
                effectLink.href = "#;";
                effectLink.style.color = "white";
                effectLink.textContent = effect.효과;
                effectDiv.appendChild(effectLink);
                effectsContainer.appendChild(effectDiv);
            });
        }

        // 효과 목록 팝업 업데이트
        const effectsList = document.getElementById('effectsList');
        if (effectsList) {
            effectsList.innerHTML = '';
            data.effects.forEach(effect => {
                const li = document.createElement('li');
                li.textContent = effect.효과;
                effectsList.appendChild(li);
            });
        }

        // 재료 업데이트
        const ingredientsContainer = document.getElementById('ingredients');
        if (ingredientsContainer) {
            ingredientsContainer.innerHTML = '';
            data.ingredients.forEach(ingredient => {
                const ingredientDiv = document.createElement('div');
                ingredientDiv.classList.add('r-icon', 'lsm10', 'mt05');
                const iconDiv = document.createElement('div');
                iconDiv.classList.add('r-icond');
                const iconImg = document.createElement('img');
                iconImg.src = '/imgs/' + ingredient.목록아이콘;
                iconDiv.appendChild(iconImg);
                const ingredientTextDiv = document.createElement('div');
                ingredientTextDiv.classList.add('tal', 'grey55');
                ingredientTextDiv.textContent = ingredient.재료목록;
                ingredientDiv.appendChild(iconDiv);
                ingredientDiv.appendChild(ingredientTextDiv);
                ingredientsContainer.appendChild(ingredientDiv);
            });
        }

        // 메인 이미지 업데이트
        const mainImageElement = document.getElementById('mainImage').querySelector('img');
        if (mainImageElement) {
            mainImageElement.src = '/imgs/' + data.base.메인이미지;
        }

        // 만드는 순서 업데이트
        const recipeStepsContainer = document.getElementById('recipeSteps');
        if (recipeStepsContainer) {
            recipeStepsContainer.innerHTML = '';
            data.recipes.forEach(recipe => {
                const stepDiv = document.createElement('div');
                stepDiv.classList.add('tal', 'grey55', 'pl2', 'pr2');
                const stepOrderSpan = document.createElement('span');
                stepOrderSpan.textContent = recipe.order;
                const stepDescriptionSpan = document.createElement('span');
                stepDescriptionSpan.textContent = recipe.description;
                stepDiv.appendChild(stepOrderSpan);
                stepDiv.appendChild(stepDescriptionSpan);
                recipeStepsContainer.appendChild(stepDiv);
            });
        }
    }

    // 팝업창 열기
    function openPopup(obj) {
        $(".layer_pop_txt").hide();
        $(obj).show();
    }

    // 팝업창 닫기
    function closePopup(obj) {
        $(obj).hide();
    }
</script>
<script>
    //팝업창 열기
    function openPopup(obj) {
        $(".layer_pop_txt").hide();
        $(obj).show();
    }

    //팝업창 닫기
    function closePopup(obj) {
        $(obj).hide();
    }

</script>
</html>
